<div class="login-bg">

    <!-- Animation -->
    <div class="birds">
        <div *ngFor="let bird of birdStyles" class="bird" [ngStyle]="{
               top: bird.top,
               animationDuration: bird.duration,
               animationDelay: bird.delay,
               transform: bird.scale
             }">
            <span class="wing left"></span>
            <span class="wing right"></span>
        </div>
    </div>

    <div class="sky">
        <span *ngFor="let star of stars" [ngStyle]="{
                top: star.top,
                left: star.left,
                width: star.size,
                height: star.size,
                animationDelay: star.delay
              }"></span>
        <div class="moon"></div>
    </div>

    <!-- CARD -->
    <div class="login-card glass">

        <h2 class="title">Đặt lại mật khẩu</h2>
        <p class="subtitle">
            Nhập mã xác nhận và mật khẩu mới của bạn
        </p>

        <!-- OTP -->
        <input type="text" placeholder="Nhập mã xác nhận (6 số)" maxlength="6" [(ngModel)]="pre.otp" required />

        <!-- New password -->
        <div class="password-wrapper">
            <input [type]="showNewPassword ? 'text' : 'password'" placeholder="Mật khẩu mới"
                [(ngModel)]="pre.new_password" (input)="checkPassword()" required />

            <span class="toggle-password" (click)="showNewPassword = !showNewPassword">
                <i class="fas" [ngClass]="showNewPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
            </span>
        </div>
        <ul class="password-rules" *ngIf="securitySettings && passwordTouched ">
            <li [class.ok]="passwordRules.minLength" [class.error]="!passwordRules.minLength">
                <span>{{ passwordRules.minLength ? '✔️' : '❌' }}</span>
                Ít nhất {{ securitySettings.passwordMinLength }} ký tự
            </li>

            <li *ngIf="securitySettings.requireSymbols" [class.ok]="passwordRules.symbol"
                [class.error]="!passwordRules.symbol">
                <span>{{ passwordRules.symbol ? '✔️' : '❌' }}</span>
                Chứa ít nhất 1 ký tự đặc biệt
            </li>
        </ul>

        <!-- Confirm password -->
        <div class="password-wrapper">
            <input [type]="showConfirmPassword ? 'text' : 'password'" placeholder="Xác nhận mật khẩu mới"
                [(ngModel)]="pre.confirm_password" required />

            <span class="toggle-password" (click)="showConfirmPassword = !showConfirmPassword">
                <i class="fas" [ngClass]="showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
            </span>
        </div>
        <div class="error-wrapper">
            <small class="text-danger" *ngIf="pre.confirm_password 
        && pre.new_password 
        && pre.confirm_password !== pre.new_password">
              ❌ Mật khẩu nhập lại không khớp
            </small>
        </div>



        <!-- Button -->
        <button class="btn-login" [disabled]="isSubmitting || pre.new_password !== pre.confirm_password"
            (click)="submitResetPassword()">
            <i class="fa-solid fa-lock me-2"></i>
            Đặt lại mật khẩu
        </button>

        <!-- Back -->
        <div class="links center">
            <a routerLink="/dang-nhap">
                ← Quay lại đăng nhập
            </a>
        </div>

    </div>
</div>