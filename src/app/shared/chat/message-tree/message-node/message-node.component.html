<div class="message" [class.self]="message.senderMemberId === currentUserId">
    <div *ngIf="message.messageType === 'image'">
        <img [src]="message.text" alt="·∫¢nh" style="max-width: 200px; border-radius: 8px;" />
    </div>
    <div *ngIf="message.messageType === 'like'">
        <span style="font-size: 35px;">üëç</span>
    </div>
    <div class="bubble" *ngIf="message.messageType !== 'image' && message.messageType !== 'like'">
        <div *ngIf="message.parentId != null" class="reply-preview">
            <ng-container *ngIf="getParentMessage(message.parentId) as parent">
                <p class="mb-1 text-muted" style="font-size: 0.875rem;">
                    <strong>{{ parent.fullename }}</strong>
                </p>
                <div *ngIf="parent.messageType === 'text'">
                    {{ parent.text }}
                </div>

                <div *ngIf="parent.messageType === 'like'">
                    {{ parent.text }}
                </div>

                <div *ngIf="parent.messageType === 'image'">
                    <img [src]="parent.text" alt="·∫¢nh" style="max-width: 100px; border-radius: 4px;" />
                </div>

                <div *ngIf="parent.messageType === 'link'">
                    <a [href]="parent.text" target="_blank">{{ parent.text }}</a>
                </div>

            </ng-container>
        </div>


        <ng-container [ngSwitch]="message.messageType">

            <div *ngSwitchCase="'text'">
                {{ message.text }}
            </div>

            <!-- <div *ngSwitchCase="'like'">
                {{ message.text }}
            </div> -->

            <div *ngSwitchCase="'link'">
                <a class="text-white" [href]="message.text" target="_blank">{{ message.text }}</a>
            </div>
            <!-- 
            <div *ngSwitchCase="'image'">
                <img [src]="message.text" alt="·∫¢nh" style="max-width: 200px; border-radius: 8px;" />
            </div> -->

            <ng-container *ngSwitchCase="'video'">
                <div *ngIf="!message.text.includes('youtube.com/watch')">
                    <video width="300" controls style="border-radius: 8px;">
                        <source [src]="message.text" type="video/mp4" />
                        Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ video.
                    </video>
                </div>

                <div *ngIf="message.text.includes('youtube.com/watch')">
                    <iframe width="300" height="180" [src]="getYoutubeEmbedUrl(message.text)" frameborder="0"
                        allowfullscreen style="border-radius: 8px;"></iframe>
                </div>
            </ng-container>

        </ng-container>
        <small class="text-white d-block mt-1" [ngClass]="{
                                'text-start': message.senderMemberId !== currentUserId,
                                'text-end': message.senderMemberId === currentUserId
                            }" style="font-size: 0.75rem;">
            {{ message.createdAt | date: 'HH:mm' }}
        </small>


    </div>

    <div class="menu-wrapper" (click)="toggleMenu(message); $event.stopPropagation()">
        <button class="menu-btn">&#8942;</button>
        <div class="dropdown-menu-message" [class.self]="message.senderMemberId != currentUserId"
            *ngIf="showMenu && menuMessage === message">
            <button (click)="deleteMessage(message)">G·ª° tin nh·∫Øn</button>
            <button (click)="replyMessage(message)">Tr·∫£ l·ªùi tin nh·∫Øn</button>
        </div>
    </div>
</div>